<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Counter with Time and Views Tracking</title>
    <style>
        /* General Reset and Styling */
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: Arial, sans-serif;
            background-color: #1e1e1e; /* Dark background */
            color: #ffffff; /* Light text */
        }

        /* Counter Box Styling */
        .counter-box {
            text-align: center;
            background-color: #333333; /* Darker background for the box */
            padding: 20px 40px;
            border-radius: 12px; /* Rounded edges */
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.4); /* Subtle shadow */
            margin: 10px; /* Add spacing between boxes */
            width: 300px;
        }

        .counter-box h1 {
            margin: 0;
            font-size: 24px;
        }

        .counter-box p {
            margin: 10px 0;
            font-size: 18px;
        }
    </style>
    <script>
        // Helper function to convert milliseconds to a readable format
        const formatTime = (milliseconds) => {
            const seconds = Math.floor(milliseconds / 1000);
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}m ${remainingSeconds}s`;
        };

        // Calculate Views for Last Week or Last Month
        const calculateViews = (timestamps, days) => {
            const currentTime = Date.now();
            const cutoffTime = currentTime - days * 24 * 60 * 60 * 1000; // Convert days to milliseconds
            return timestamps.filter(timestamp => timestamp >= cutoffTime).length;
        };

        const displayStats = () => {
            // Data for Home Page
            const homeTimestamps = JSON.parse(localStorage.getItem('homePage_timestamps') || '[]');
            const homeMaxTime = parseInt(localStorage.getItem('homePage_maxTime') || '0', 10);

            const homeWeeklyViews = calculateViews(homeTimestamps, 7); // Last 7 days
            const homeMonthlyViews = calculateViews(homeTimestamps, 30); // Last 30 days

            document.getElementById('visitorCountHome').innerText = `Total Visitors: ${homeTimestamps.length}`;
            document.getElementById('weeklyViewsHome').innerText = `Views Last Week: ${homeWeeklyViews}`;
            document.getElementById('monthlyViewsHome').innerText = `Views Last Month: ${homeMonthlyViews}`;
            document.getElementById('maxTimeHome').innerText = `Most Time Spent: ${formatTime(homeMaxTime)}`;

            // Data for Weather Page
            const weatherTimestamps = JSON.parse(localStorage.getItem('weatherPage_timestamps') || '[]');
            const weatherMaxTime = parseInt(localStorage.getItem('weatherPage_maxTime') || '0', 10);

            const weatherWeeklyViews = calculateViews(weatherTimestamps, 7); // Last 7 days
            const weatherMonthlyViews = calculateViews(weatherTimestamps, 30); // Last 30 days

            document.getElementById('visitorCountWeather').innerText = `Total Visitors: ${weatherTimestamps.length}`;
            document.getElementById('weeklyViewsWeather').innerText = `Views Last Week: ${weatherWeeklyViews}`;
            document.getElementById('monthlyViewsWeather').innerText = `Views Last Month: ${weatherMonthlyViews}`;
            document.getElementById('maxTimeWeather').innerText = `Most Time Spent: ${formatTime(weatherMaxTime)}`;
        };

        const trackTimeOnPage = (pageKey) => {
            const startTime = Date.now(); // Record the time when the user enters the page

            // When the user leaves the page
            window.addEventListener('beforeunload', () => {
                const endTime = Date.now(); // Record the time when the user leaves
                const timeSpent = endTime - startTime; // Calculate time spent in milliseconds

                // Get the current maximum time spent from localStorage
                const maxTimeSpent = parseInt(localStorage.getItem(`${pageKey}_maxTime`) || '0', 10);

                // Update the maximum time if the new visit exceeds the current record
                if (timeSpent > maxTimeSpent) {
                    localStorage.setItem(`${pageKey}_maxTime`, timeSpent);
                }

                // Store timestamps for weekly and monthly views tracking
                let timestamps = JSON.parse(localStorage.getItem(`${pageKey}_timestamps`)) || [];
                timestamps.push(startTime); // Add the visit's start time
                localStorage.setItem(`${pageKey}_timestamps`, JSON.stringify(timestamps));
            });
        };

        // Call this function with a unique key for each page
        if (window.location.pathname === '/') {
            trackTimeOnPage('homePage');
        } else if (window.location.pathname === '/apps/weather') {
            trackTimeOnPage('weatherPage');
        }

        document.addEventListener('DOMContentLoaded', displayStats);
    </script>
</head>
<body>
    <!-- Counter for the Home Page -->
    <div class="counter-box">
        <h1>Home Page Visitors</h1>
        <p id="visitorCountHome">Loading visitor count...</p>
        <p id="weeklyViewsHome">Views Last Week: Loading...</p>
        <p id="monthlyViewsHome">Views Last Month: Loading...</p>
        <p id="maxTimeHome">Most Time Spent: Loading...</p>
    </div>

    <!-- Counter for the Weather Page -->
    <div class="counter-box">
        <h1>Weather Page Visitors</h1>
        <p id="visitorCountWeather">Loading visitor count...</p>
        <p id="weeklyViewsWeather">Views Last Week: Loading...</p>
        <p id="monthlyViewsWeather">Views Last Month: Loading...</p>
        <p id="maxTimeWeather">Most Time Spent: Loading...</p>
    </div>
</body>
</html>
