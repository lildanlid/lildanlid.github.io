<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JavaScript Deobfuscator</title>
  <style>
    /* Body and basic styling */
    body {
      background-color: #000;
      color: #0f0;
      font-family: monospace;
      padding: 20px;
      margin: 0;
      height: 100vh;
      position: relative;
      overflow: hidden;
    }

    h1 {
      color: #0f0;
      font-size: 24px;
      display: flex;
      align-items: center;
      z-index: 10;
    }

    h1 img {
      width: 28px;
      margin-right: 10px;
    }

    /* Style for the textareas and buttons */
    textarea {
      width: 100%;
      height: 300px;
      background: #000;
      color: #0f0;
      border: 1px solid #0f0;
      padding: 10px;
      margin-bottom: 10px;
      font-family: monospace;
      z-index: 10;
    }

    #dropZone {
      border: 2px dashed #0f0;
      padding: 30px;
      text-align: center;
      margin-bottom: 10px;
      z-index: 10;
    }

    button {
      background: #000;
      border: 1px solid #0f0;
      color: #0f0;
      padding: 10px 20px;
      cursor: pointer;
      margin-right: 10px;
      display: inline-flex;
      align-items: center;
      z-index: 10;
    }

    button img {
      width: 20px;
      margin-right: 8px;
    }

    button:hover {
      background: #0f0;
      color: #000;
    }

    /* Adjust the spacing for buttons and textareas */
    #output {
      height: 200px;
    }
  </style>

  <!-- Link to Google Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
  <h1>
    <span class="material-icons">laptop</span>
    JavaScript Deobfuscator
  </h1>

  <div id="dropZone">
    <span class="material-icons" style="font-size: 32px;">folder_open</span>
    Drag & Drop a JS file here
  </div>

  <textarea id="input" placeholder="Or paste obfuscated code here..."></textarea>

  <button onclick="process()">
    <span class="material-icons">cleaning_services</span>
    Deobfuscate + Beautify
  </button>

  <button onclick="beautifyOnly()">
    <span class="material-icons">brush</span>
    Beautify Only
  </button>

  <textarea id="output" placeholder="Result appears here..."></textarea>

  <!-- Beautifier -->
  <script src="https://cdn.jsdelivr.net/npm/js-beautify@1.14.0/js/lib/beautify.js"></script>
  <script>
    // Drag & Drop functionality
    const dropZone = document.getElementById('dropZone');
    dropZone.addEventListener('dragover', e => {
      e.preventDefault();
      dropZone.style.borderColor = '#fff';
    });
    dropZone.addEventListener('dragleave', () => {
      dropZone.style.borderColor = '#0f0';
    });
    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      dropZone.style.borderColor = '#0f0';
      const file = e.dataTransfer.files[0];
      if (file && file.name.endsWith('.js')) {
        const reader = new FileReader();
        reader.onload = ev => {
          document.getElementById('input').value = ev.target.result;
        };
        reader.readAsText(file);
      }
    });

    // Beautify Only (without deobfuscation)
    function beautifyOnly() {
      const input = document.getElementById('input').value;
      const output = js_beautify(input, { indent_size: 2 });
      document.getElementById('output').value = output;
    }

    // Deobfuscate and Beautify
    function process() {
      let code = document.getElementById('input').value;

      // Deobfuscate function mappings like _0x5956()
      const mappings = extractMappings(code);
      if (mappings) {
        code = decodeMappingCalls(code, mappings);
      }

      // Beautify the code after deobfuscation
      const beautified = js_beautify(code, { indent_size: 2 });
      document.getElementById('output').value = beautified;
    }

    // Function to extract mappings like _0x5956()
    function extractMappings(code) {
      const mappingArrayMatch = code.match(/var\s+(_0x\w+)\s*=\s*\[(.*?)\];/);
      if (!mappingArrayMatch) return null;

      const arrayName = mappingArrayMatch[1];
      const arrayRaw = `[${mappingArrayMatch[2]}]`;

      try {
        return eval(arrayRaw);
      } catch (e) {
        alert("❌ Failed to parse mapping array.");
        return null;
      }
    }

    // Function to decode obfuscated calls using the extracted mappings
    function decodeMappingCalls(code, mappings) {
      // Replace _0x5956(0x1) style calls
      const regex = /_0x\w+\((0x[0-9a-f]+)\)/g;
      return code.replace(regex, (match, hex) => {
        const index = parseInt(hex, 16);
        return `"${mappings[index] || ''}"`; // Return the decoded value
      });
    }
  </script>
</body>
</html>
