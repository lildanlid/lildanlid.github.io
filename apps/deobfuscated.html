<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JavaScript Deobfuscator</title>
  <style>
    body {
      background-color: #000;
      color: #0f0;
      font-family: monospace;
      padding: 20px;
      margin: 0;
      height: 100vh;
      position: relative;
      overflow: hidden;
    }

    h1 {
      color: #0f0;
      font-size: 24px;
      display: flex;
      align-items: center;
      z-index: 10;
    }

    h1 img {
      width: 28px;
      margin-right: 10px;
    }

    textarea {
      width: 100%;
      height: 300px;
      background: #000;
      color: #0f0;
      border: 1px solid #0f0;
      padding: 10px;
      margin-bottom: 10px;
      font-family: monospace;
      z-index: 10;
      resize: vertical;
      overflow-y: auto;
      white-space: pre-wrap;
    }

    #dropZone {
      border: 2px dashed #0f0;
      padding: 30px;
      text-align: center;
      margin-bottom: 10px;
      z-index: 10;
    }

    button {
      background: #000;
      border: 1px solid #0f0;
      color: #0f0;
      padding: 10px 20px;
      cursor: pointer;
      margin-right: 10px;
      display: inline-flex;
      align-items: center;
      z-index: 10;
    }

    button img {
      width: 20px;
      margin-right: 8px;
    }

    button:hover {
      background: #0f0;
      color: #000;
    }

    #output {
      height: 200px;
      overflow-y: auto;
    }

    #copyBtn {
      background: #0f0;
      color: #000;
      border: 1px solid #0f0;
    }
  </style>

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
  <h1>
    <span class="material-icons">laptop</span>
    JavaScript Deobfuscator
  </h1>

  <div id="dropZone">
    <span class="material-icons" style="font-size: 32px;">folder_open</span>
    Drag & Drop a JS file here
  </div>

  <textarea id="input" placeholder="Or paste obfuscated code here..."></textarea>

  <button onclick="process()">
    <span class="material-icons">cleaning_services</span>
    Deobfuscate + Beautify
  </button>

  <button onclick="beautifyOnly()">
    <span class="material-icons">brush</span>
    Beautify Only
  </button>

  <textarea id="output" placeholder="Result appears here..."></textarea>

  <button id="copyBtn" onclick="copyToClipboard()">
    <span class="material-icons">content_copy</span>
    Copy to Clipboard
  </button>

  <script src="https://cdn.jsdelivr.net/npm/js-beautify@1.14.0/js/lib/beautify.js"></script>
  <script>
    const dropZone = document.getElementById('dropZone');
    dropZone.addEventListener('dragover', e => {
      e.preventDefault();
      dropZone.style.borderColor = '#fff';
    });
    dropZone.addEventListener('dragleave', () => {
      dropZone.style.borderColor = '#0f0';
    });
    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      dropZone.style.borderColor = '#0f0';
      const file = e.dataTransfer.files[0];
      if (file && file.name.endsWith('.js')) {
        const reader = new FileReader();
        reader.onload = ev => {
          document.getElementById('input').value = ev.target.result;
        };
        reader.readAsText(file);
      }
    });

    function beautifyOnly() {
      const input = document.getElementById('input').value;
      const output = js_beautify(input, { indent_size: 2 });
      appendToOutput(output);
    }

    function process() {
      let code = document.getElementById('input').value;

      // Step 1: Extract mappings and decode
      const mappings = extractMappings(code);
      if (mappings) {
        code = decodeMappingCalls(code, mappings);
      }

      // Step 2: Beautify the decoded code
      const beautified = js_beautify(code, { indent_size: 2 });
      appendToOutput(beautified);
    }

    // Function to extract mappings like _0x5956()
    function extractMappings(code) {
      const mappingArrayMatch = code.match(/var\s+(_0x\w+)\s*=\s*\[(.*?)\];/);
      if (!mappingArrayMatch) return null;

      const arrayName = mappingArrayMatch[1];
      const arrayRaw = `[${mappingArrayMatch[2]}]`;

      try {
        return eval(arrayRaw);  // This will evaluate the array and extract values
      } catch (e) {
        alert("❌ Failed to parse mapping array.");
        return null;
      }
    }

    // Decode the obfuscation calls such as _0x5956(0x1)
    function decodeMappingCalls(code, mappings) {
      const regex = /_0x\w+\((0x[0-9a-f]+)\)/g;
      return code.replace(regex, (match, hex) => {
        const index = parseInt(hex, 16);
        return `"${mappings[index] || ''}"`;
      });
    }

    // Function to append output to the output textarea with infinite scrolling
    function appendToOutput(newContent) {
      const output = document.getElementById('output');
      output.value += newContent + "\n";  // Append new content
      output.scrollTop = output.scrollHeight;  // Auto-scroll to bottom
    }

    // Copy the deobfuscated code to clipboard
    function copyToClipboard() {
      const outputText = document.getElementById('output').value;
      navigator.clipboard.writeText(outputText)
        .then(() => {
          alert("✅ Code copied to clipboard!");
        })
        .catch(err => {
          alert("❌ Failed to copy text: " + err);
        });
    }

  </script>
</body>
</html>
