<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Coding Assistant</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; margin: 0; padding: 20px; min-height: 100vh; display: flex; justify-content: center; align-items: center; }
    .chat-container { width: 100%; max-width: 900px; height: 90vh; background: white; border-radius: 12px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; overflow: hidden; }
    .messages { flex: 1; overflow-y: auto; padding: 20px; }
    .user-message { background: #3b82f6; color: white; padding: 12px 16px; border-radius: 12px; margin-left: auto; max-width: 80%; margin-bottom: 12px; }
    .ai-message { background: #f3f4f6; color: #111827; padding: 12px 16px; border-radius: 12px; margin-right: auto; max-width: 80%; margin-bottom: 12px; }
    .code-block { background: #1e293b; color: #86efac; padding: 12px; border-radius: 6px; font-family: 'Courier New', monospace; overflow-x: auto; margin: 8px 0; position: relative; }
    .file-header { background: #334155; color: #d1d5db; padding: 6px 12px; border-radius: 6px 6px 0 0; font-family: monospace; display: flex; justify-content: space-between; }
    .download-btn { background: #3b82f6; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; cursor: pointer; }
    .download-btn:hover { background: #2563eb; }
    .typing-indicator { display: flex; padding: 8px; }
    .typing-dot { width: 8px; height: 8px; margin: 0 2px; background-color: #6b7280; border-radius: 50%; animation: typingAnimation 1.4s infinite ease-in-out; }
    @keyframes typingAnimation { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-5px); } }
    .input-area { padding: 16px; border-top: 1px solid #e5e7eb; background: white; }
    .tabs { display: flex; border-bottom: 1px solid #e5e7eb; padding: 0 16px; }
    .tab { padding: 12px 16px; cursor: pointer; border-bottom: 2px solid transparent; }
    .tab.active { border-bottom-color: #3b82f6; font-weight: 500; }
    .language-selector { margin-left: auto; padding: 8px; border-radius: 4px; border: 1px solid #e5e7eb; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    function AdvancedCodingAssistant() {
      const [messages, setMessages] = useState([]);
      const [inputValue, setInputValue] = useState('');
      const [isLoading, setIsLoading] = useState(false);
      const [activeTab, setActiveTab] = useState('chat');
      const [selectedLanguage, setSelectedLanguage] = useState('javascript');
      const messagesEndRef = useRef(null);

      // Enhanced knowledge base with file generation capability
      const codingKnowledge = {
        "hello": "Hello! I'm your advanced coding assistant. I can generate complete code files, explain concepts, and help with multiple programming languages.",
        "help": "I can:\n- Generate complete code files (downloadable)\n- Explain programming concepts\n- Provide code examples in:\n  • JavaScript/TypeScript\n  • Python\n  • React\n  • HTML/CSS\n  • Node.js\n  • SQL\n\nTry: 'Create a React component' or 'Show me a Python Flask API'",
        
        // File generation templates
        "react component": {
          filename: "MyComponent.jsx",
          content: `import React from 'react';\n\nfunction MyComponent({ title }) {\n  return (\n    <div className="p-4 border rounded-lg">\n      <h1 className="text-xl font-bold">{title}</h1>\n      <p>This is a reusable React component.</p>\n    </div>\n  );\n}\n\nexport default MyComponent;`,
          language: "javascript"
        },
        "python api": {
          filename: "api.py",
          content: `from flask import Flask, jsonify\n\napp = Flask(__name__)\n\n@app.route('/api/hello')\ndef hello():\n    return jsonify({"message": "Hello from Python API!"})\n\nif __name__ == '__main__':\n    app.run(debug=True)`,
          language: "python"
        },
        "node server": {
          filename: "server.js",
          content: `const express = require('express');\nconst app = express();\nconst PORT = 3000;\n\napp.get('/', (req, res) => {\n  res.send('Hello from Node.js server!');\n});\n\napp.listen(PORT, () => {\n  console.log(\`Server running on http://localhost:\${PORT}\`);\n});`,
          language: "javascript"
        },
        "html template": {
          filename: "index.html",
          content: `<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>My Page</title>\n  <script src="https://cdn.tailwindcss.com"></script>\n</head>\n<body class="bg-gray-100">\n  <div class="container mx-auto p-4">\n    <h1 class="text-3xl font-bold text-blue-600">Welcome!</h1>\n    <p class="mt-2">This is a responsive HTML template with Tailwind CSS.</p>\n  </div>\n</body>\n</html>`,
          language: "html"
        },
        
        // Code examples
        "function": {
          content: `// JavaScript function\nexample = (name) => {\n  return \`Hello, \${name}!\`;\n};\n\n// Python function\ndef example(name):\n    return f"Hello, {name}!"`,
          language: "javascript"
        },
        "loop": {
          content: `// JavaScript for loop\nfor (let i = 0; i < 5; i++) {\n  console.log(i);\n}\n\n// Python for loop\nfor i in range(5):\n    print(i)`,
          language: "javascript"
        },
        "promise": {
          content: `// JavaScript Promise\nfunction fetchData() {\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      resolve('Data loaded');\n    }, 1000);\n  });\n}\n\n// Using async/await\nasync function getData() {\n  const data = await fetchData();\n  console.log(data);\n}`,
          language: "javascript"
        }
      };

      // Initialize with welcome message
      useEffect(() => {
        const savedMessages = localStorage.getItem('advanced-coding-messages');
        if (savedMessages) {
          setMessages(JSON.parse(savedMessages));
        } else {
          setMessages([{
            id: '1',
            text: 'Hello! I\'m your advanced coding assistant. I can generate complete code files and explain programming concepts.\n\nTry: "Create a React component" or "Show me a Python API example"',
            sender: 'ai'
          }]);
        }
      }, []);

      // Save messages to localStorage
      useEffect(() => {
        if (messages.length > 0) {
          localStorage.setItem('advanced-coding-messages', JSON.stringify(messages));
        }
      }, [messages]);

      // Auto-scroll to bottom
      useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      }, [messages]);

      const handleSendMessage = () => {
        if (!inputValue.trim()) return;

        // Add user message
        const userMessage = {
          id: Date.now().toString(),
          text: inputValue,
          sender: 'user'
        };
        setMessages(prev => [...prev, userMessage]);
        setInputValue('');

        // Simulate typing delay
        setIsLoading(true);
        setTimeout(() => {
          getResponse(inputValue);
          setIsLoading(false);
        }, 500);
      };

      const getResponse = (prompt) => {
        const lowerPrompt = prompt.toLowerCase();
        let response = {
          text: "I can help with code generation and programming concepts. Try asking for a specific file or concept like 'Create a React component' or 'Explain promises'.",
          isCode: false
        };
        
        // Check for matching keywords
        for (const [keyword, answer] of Object.entries(codingKnowledge)) {
          if (lowerPrompt.includes(keyword)) {
            response = typeof answer === 'string' 
              ? { text: answer, isCode: answer.includes('\n') }
              : { 
                  text: answer.content, 
                  isCode: true,
                  isFile: true,
                  filename: answer.filename,
                  language: answer.language || selectedLanguage
                };
            break;
          }
        }

        // Add AI response
        setMessages(prev => [...prev, {
          id: Date.now().toString() + 1,
          ...response,
          sender: 'ai'
        }]);
      };

      const downloadFile = (filename, content) => {
        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      };

      const clearHistory = () => {
        if (confirm('Clear all chat history?')) {
          setMessages([{
            id: '1',
            text: 'Hello! I\'m your advanced coding assistant. I can generate complete code files and explain programming concepts.\n\nTry: "Create a React component" or "Show me a Python API example"',
            sender: 'ai'
          }]);
          localStorage.removeItem('advanced-coding-messages');
        }
      };

      const formatMessage = (message) => {
        if (message.isCode) {
          return (
            <div className="code-block">
              {message.isFile && (
                <div className="file-header">
                  <span>{message.filename || 'code.txt'}</span>
                  <button 
                    onClick={() => downloadFile(
                      message.filename || 'code.txt', 
                      message.text
                    )}
                    className="download-btn"
                  >
                    Download
                  </button>
                </div>
              )}
              <pre>{message.text}</pre>
            </div>
          );
        }
        return message.text.split('\n').map((line, i) => <p key={i}>{line}</p>);
      };

      return (
        <div className="chat-container">
          {/* Header with tabs */}
          <div className="bg-blue-600 text-white p-4">
            <div className="flex justify-between items-center">
              <h1 className="text-xl font-bold">Advanced Coding Assistant</h1>
              <button 
                onClick={clearHistory}
                className="text-sm bg-blue-700 hover:bg-blue-800 px-3 py-1 rounded"
              >
                Clear History
              </button>
            </div>
          </div>

          {/* Messages */}
          <div className="messages">
            {messages.map(message => (
              <div
                key={message.id}
                className={message.sender === 'user' ? 'user-message' : 'ai-message'}
              >
                {formatMessage(message)}
              </div>
            ))}

            {isLoading && (
              <div className="ai-message">
                <div className="typing-indicator">
                  <div className="typing-dot"></div>
                  <div className="typing-dot"></div>
                  <div className="typing-dot"></div>
                </div>
              </div>
            )}
            <div ref={messagesEndRef} />
          </div>

          {/* Input Area */}
          <div className="input-area">
            <div className="flex gap-2 mb-2">
              <select 
                value={selectedLanguage}
                onChange={(e) => setSelectedLanguage(e.target.value)}
                className="language-selector"
              >
                <option value="javascript">JavaScript</option>
                <option value="python">Python</option>
                <option value="react">React</option>
                <option value="html">HTML</option>
                <option value="node">Node.js</option>
              </select>
            </div>
            <div className="flex gap-2">
              <input
                type="text"
                value={inputValue}
                onChange={(e) => setInputValue(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
                placeholder={`Ask for code (e.g. "Create a ${selectedLanguage} ${selectedLanguage === 'react' ? 'component' : selectedLanguage === 'python' ? 'API' : 'function'}")`}
                className="flex-1 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                disabled={isLoading}
              />
              <button
                onClick={handleSendMessage}
                disabled={!inputValue.trim() || isLoading}
                className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 disabled:opacity-50"
              >
                Send
              </button>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<AdvancedCodingAssistant />);
  </script>
</body>
</html>
