<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Claude Coding Assistant</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Same styles as before */
    body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; margin: 0; padding: 20px; min-height: 100vh; display: flex; justify-content: center; align-items: center; }
    .chat-container { width: 100%; max-width: 800px; height: 80vh; background: white; border-radius: 12px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; overflow: hidden; }
    .messages { flex: 1; overflow-y: auto; padding: 20px; }
    .user-message { background: #3b82f6; color: white; padding: 12px 16px; border-radius: 12px; margin-left: auto; max-width: 80%; margin-bottom: 12px; }
    .ai-message { background: #f3f4f6; color: #111827; padding: 12px 16px; border-radius: 12px; margin-right: auto; max-width: 80%; margin-bottom: 12px; }
    .code-block { background: #1e293b; color: #86efac; padding: 12px; border-radius: 6px; font-family: 'Courier New', monospace; overflow-x: auto; margin: 8px 0; }
    .typing-indicator { display: flex; padding: 8px; }
    .typing-dot { width: 8px; height: 8px; margin: 0 2px; background-color: #6b7280; border-radius: 50%; animation: typingAnimation 1.4s infinite ease-in-out; }
    @keyframes typingAnimation { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-5px); } }
    .error-message { background: #fee2e2; color: #b91c1c; padding: 12px; border-radius: 6px; margin-bottom: 16px; }
    .input-area { padding: 16px; border-top: 1px solid #e5e7eb; background: white; }
    .confirmation-dialog { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; }
    .confirmation-box { background: white; padding: 24px; border-radius: 12px; max-width: 400px; width: 100%; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); }
    .api-key-guide { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px; margin-top: 16px; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    function ClaudeCodingAssistant() {
      const [messages, setMessages] = useState([]);
      const [inputValue, setInputValue] = useState('');
      const [apiKey, setApiKey] = useState(localStorage.getItem('claude-api-key') || '');
      const [isLoading, setIsLoading] = useState(false);
      const [error, setError] = useState('');
      const [showApiInput, setShowApiInput] = useState(!apiKey);
      const [showConfirm, setShowConfirm] = useState(false);
      const [showGuide, setShowGuide] = useState(false);
      const messagesEndRef = useRef(null);

      // Initialize with welcome message
      useEffect(() => {
        const savedMessages = localStorage.getItem('claude-messages');
        if (savedMessages) {
          setMessages(JSON.parse(savedMessages));
        } else {
          setMessages([{
            id: '1',
            text: 'Hello! I\'m Claude, your AI coding assistant. How can I help you with programming today?',
            sender: 'ai'
          }]);
        }
      }, []);

      // Save messages to localStorage
      useEffect(() => {
        if (messages.length > 0) {
          localStorage.setItem('claude-messages', JSON.stringify(messages));
        }
      }, [messages]);

      // Auto-scroll to bottom
      useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      }, [messages]);

      const callClaudeAPI = async (prompt) => {
        setIsLoading(true);
        setError('');
        
        try {
          const response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'x-api-key': apiKey,
              'anthropic-version': '2023-06-01'
            },
            body: JSON.stringify({
              model: 'claude-3-sonnet-20240229',
              max_tokens: 1000,
              messages: [{
                role: 'user',
                content: prompt
              }]
            })
          });

          if (!response.ok) {
            throw new Error(response.status === 401 ? 
              'Invalid API key. Please check your key.' : 
              `API request failed (${response.status})`);
          }

          const data = await response.json();
          return data.content[0].text;
          
        } catch (error) {
          setError(error.message);
          return null;
        } finally {
          setIsLoading(false);
        }
      };

      const handleSendMessage = async () => {
        if (!inputValue.trim()) return;
        if (!apiKey.trim()) {
          setError('Please enter your API key');
          setShowApiInput(true);
          return;
        }

        // Add user message
        const userMessage = {
          id: Date.now().toString(),
          text: inputValue,
          sender: 'user'
        };
        setMessages(prev => [...prev, userMessage]);
        setInputValue('');

        // Get AI response
        const aiResponse = await callClaudeAPI(inputValue);
        if (aiResponse) {
          setMessages(prev => [...prev, {
            id: Date.now().toString() + 1,
            text: aiResponse,
            sender: 'ai',
            isCode: aiResponse.includes('```')
          }]);
        }
      };

      const clearHistory = () => {
        setMessages([{
          id: '1',
          text: 'Hello! I\'m Claude, your AI coding assistant. How can I help you with programming today?',
          sender: 'ai'
        }]);
        localStorage.removeItem('claude-messages');
        setShowConfirm(false);
      };

      const formatMessage = (text, isCode) => {
        if (isCode) {
          const codeBlocks = text.match(/```[\s\S]*?```/g) || [];
          let formattedText = text;
          
          codeBlocks.forEach((block, i) => {
            formattedText = formattedText.replace(block, `CODEBLOCK${i}`);
          });
          
          return formattedText.split('\n').map((paragraph, i) => (
            paragraph.startsWith('CODEBLOCK') ? (
              <pre key={i} className="code-block">
                {codeBlocks[parseInt(paragraph.replace('CODEBLOCK', ''))]
                  .replace(/```(\w*)\n?/, '')
                  .replace(/```$/, '')}
              </pre>
            ) : (
              <p key={i}>{paragraph}</p>
            )
          ));
        }
        
        return text.split('\n').map((line, i) => <p key={i}>{line}</p>);
      };

      return (
        <div className="chat-container">
          {/* Header */}
          <div className="bg-purple-600 text-white p-4">
            <div className="flex justify-between items-center">
              <h1 className="text-xl font-bold">Claude Coding Assistant</h1>
              <div className="flex gap-2">
                <button 
                  onClick={() => setShowConfirm(true)}
                  className="text-sm bg-purple-700 hover:bg-purple-800 px-3 py-1 rounded"
                >
                  Clear History
                </button>
                <button 
                  onClick={() => setShowApiInput(true)}
                  className="text-sm bg-purple-700 hover:bg-purple-800 px-3 py-1 rounded"
                >
                  API Key
                </button>
              </div>
            </div>
          </div>

          {/* API Key Input */}
          {showApiInput && (
            <div className="p-4 border-b">
              <div className="flex gap-2 mb-2">
                <input
                  type="password"
                  value={apiKey}
                  onChange={(e) => setApiKey(e.target.value)}
                  placeholder="Enter Anthropic API key"
                  className="flex-1 p-2 border rounded"
                />
                <button
                  onClick={() => {
                    if (apiKey.trim()) {
                      setShowApiInput(false);
                      setError('');
                      localStorage.setItem('claude-api-key', apiKey);
                    }
                  }}
                  className="bg-purple-600 text-white px-4 py-2 rounded"
                >
                  Save
                </button>
              </div>
              <button 
                onClick={() => setShowGuide(!showGuide)}
                className="text-sm text-purple-600 hover:underline"
              >
                {showGuide ? 'Hide' : 'Show'} API Key Guide
              </button>
              
              {showGuide && (
                <div className="api-key-guide">
                  <h3 className="font-bold mb-2">How to get your API key:</h3>
                  <ol className="list-decimal pl-5 space-y-1 text-sm">
                    <li>Go to <a href="https://console.anthropic.com/settings/keys" target="_blank" className="text-purple-600 hover:underline">Anthropic API Keys</a></li>
                    <li>Sign in or create an account</li>
                    <li>Click "Create Key"</li>
                    <li>Copy the key and paste it above</li>
                    <li>Note: Claude API has separate rate limits from ChatGPT</li>
                  </ol>
                </div>
              )}
            </div>
          )}

          {/* Messages */}
          <div className="messages">
            {error && (
              <div className="error-message">
                {error}
                {error.includes('Invalid API key') && (
                  <button 
                    onClick={() => setShowApiInput(true)}
                    className="text-purple-600 hover:underline ml-2"
                  >
                    Update Key
                  </button>
                )}
              </div>
            )}

            {messages.map(message => (
              <div
                key={message.id}
                className={message.sender === 'user' ? 'user-message' : 'ai-message'}
              >
                {formatMessage(message.text, message.isCode)}
              </div>
            ))}

            {isLoading && (
              <div className="ai-message">
                <div className="typing-indicator">
                  <div className="typing-dot"></div>
                  <div className="typing-dot"></div>
                  <div className="typing-dot"></div>
                </div>
              </div>
            )}
            <div ref={messagesEndRef} />
          </div>

          {/* Input Area */}
          <div className="input-area">
            <div className="flex gap-2">
              <input
                type="text"
                value={inputValue}
                onChange={(e) => setInputValue(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
                placeholder="Type your coding question..."
                className="flex-1 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                disabled={isLoading}
              />
              <button
                onClick={handleSendMessage}
                disabled={!inputValue.trim() || isLoading}
                className="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 disabled:opacity-50"
              >
                Send
              </button>
            </div>
          </div>

          {/* Confirmation Dialog */}
          {showConfirm && (
            <div className="confirmation-dialog">
              <div className="confirmation-box">
                <h3 className="font-bold text-lg mb-4">Clear Chat History</h3>
                <p className="mb-6">Are you sure you want to delete all chat history? This cannot be undone.</p>
                <div className="flex justify-end gap-3">
                  <button
                    onClick={() => setShowConfirm(false)}
                    className="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={clearHistory}
                    className="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"
                  >
                    Delete
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<ClaudeCodingAssistant />);
  </script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Claude Coding Assistant</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Same styles as before */
    body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; margin: 0; padding: 20px; min-height: 100vh; display: flex; justify-content: center; align-items: center; }
    .chat-container { width: 100%; max-width: 800px; height: 80vh; background: white; border-radius: 12px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; overflow: hidden; }
    .messages { flex: 1; overflow-y: auto; padding: 20px; }
    .user-message { background: #3b82f6; color: white; padding: 12px 16px; border-radius: 12px; margin-left: auto; max-width: 80%; margin-bottom: 12px; }
    .ai-message { background: #f3f4f6; color: #111827; padding: 12px 16px; border-radius: 12px; margin-right: auto; max-width: 80%; margin-bottom: 12px; }
    .code-block { background: #1e293b; color: #86efac; padding: 12px; border-radius: 6px; font-family: 'Courier New', monospace; overflow-x: auto; margin: 8px 0; }
    .typing-indicator { display: flex; padding: 8px; }
    .typing-dot { width: 8px; height: 8px; margin: 0 2px; background-color: #6b7280; border-radius: 50%; animation: typingAnimation 1.4s infinite ease-in-out; }
    @keyframes typingAnimation { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-5px); } }
    .error-message { background: #fee2e2; color: #b91c1c; padding: 12px; border-radius: 6px; margin-bottom: 16px; }
    .input-area { padding: 16px; border-top: 1px solid #e5e7eb; background: white; }
    .confirmation-dialog { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; }
    .confirmation-box { background: white; padding: 24px; border-radius: 12px; max-width: 400px; width: 100%; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); }
    .api-key-guide { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px; margin-top: 16px; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    function ClaudeCodingAssistant() {
      const [messages, setMessages] = useState([]);
      const [inputValue, setInputValue] = useState('');
      const [apiKey, setApiKey] = useState(localStorage.getItem('claude-api-key') || '');
      const [isLoading, setIsLoading] = useState(false);
      const [error, setError] = useState('');
      const [showApiInput, setShowApiInput] = useState(!apiKey);
      const [showConfirm, setShowConfirm] = useState(false);
      const [showGuide, setShowGuide] = useState(false);
      const messagesEndRef = useRef(null);

      // Initialize with welcome message
      useEffect(() => {
        const savedMessages = localStorage.getItem('claude-messages');
        if (savedMessages) {
          setMessages(JSON.parse(savedMessages));
        } else {
          setMessages([{
            id: '1',
            text: 'Hello! I\'m Claude, your AI coding assistant. How can I help you with programming today?',
            sender: 'ai'
          }]);
        }
      }, []);

      // Save messages to localStorage
      useEffect(() => {
        if (messages.length > 0) {
          localStorage.setItem('claude-messages', JSON.stringify(messages));
        }
      }, [messages]);

      // Auto-scroll to bottom
      useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      }, [messages]);

      const callClaudeAPI = async (prompt) => {
        setIsLoading(true);
        setError('');
        
        try {
          const response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'x-api-key': apiKey,
              'anthropic-version': '2023-06-01'
            },
            body: JSON.stringify({
              model: 'claude-3-sonnet-20240229',
              max_tokens: 1000,
              messages: [{
                role: 'user',
                content: prompt
              }]
            })
          });

          if (!response.ok) {
            throw new Error(response.status === 401 ? 
              'Invalid API key. Please check your key.' : 
              `API request failed (${response.status})`);
          }

          const data = await response.json();
          return data.content[0].text;
          
        } catch (error) {
          setError(error.message);
          return null;
        } finally {
          setIsLoading(false);
        }
      };

      const handleSendMessage = async () => {
        if (!inputValue.trim()) return;
        if (!apiKey.trim()) {
          setError('Please enter your API key');
          setShowApiInput(true);
          return;
        }

        // Add user message
        const userMessage = {
          id: Date.now().toString(),
          text: inputValue,
          sender: 'user'
        };
        setMessages(prev => [...prev, userMessage]);
        setInputValue('');

        // Get AI response
        const aiResponse = await callClaudeAPI(inputValue);
        if (aiResponse) {
          setMessages(prev => [...prev, {
            id: Date.now().toString() + 1,
            text: aiResponse,
            sender: 'ai',
            isCode: aiResponse.includes('```')
          }]);
        }
      };

      const clearHistory = () => {
        setMessages([{
          id: '1',
          text: 'Hello! I\'m Claude, your AI coding assistant. How can I help you with programming today?',
          sender: 'ai'
        }]);
        localStorage.removeItem('claude-messages');
        setShowConfirm(false);
      };

      const formatMessage = (text, isCode) => {
        if (isCode) {
          const codeBlocks = text.match(/```[\s\S]*?```/g) || [];
          let formattedText = text;
          
          codeBlocks.forEach((block, i) => {
            formattedText = formattedText.replace(block, `CODEBLOCK${i}`);
          });
          
          return formattedText.split('\n').map((paragraph, i) => (
            paragraph.startsWith('CODEBLOCK') ? (
              <pre key={i} className="code-block">
                {codeBlocks[parseInt(paragraph.replace('CODEBLOCK', ''))]
                  .replace(/```(\w*)\n?/, '')
                  .replace(/```$/, '')}
              </pre>
            ) : (
              <p key={i}>{paragraph}</p>
            )
          ));
        }
        
        return text.split('\n').map((line, i) => <p key={i}>{line}</p>);
      };

      return (
        <div className="chat-container">
          {/* Header */}
          <div className="bg-purple-600 text-white p-4">
            <div className="flex justify-between items-center">
              <h1 className="text-xl font-bold">Claude Coding Assistant</h1>
              <div className="flex gap-2">
                <button 
                  onClick={() => setShowConfirm(true)}
                  className="text-sm bg-purple-700 hover:bg-purple-800 px-3 py-1 rounded"
                >
                  Clear History
                </button>
                <button 
                  onClick={() => setShowApiInput(true)}
                  className="text-sm bg-purple-700 hover:bg-purple-800 px-3 py-1 rounded"
                >
                  API Key
                </button>
              </div>
            </div>
          </div>

          {/* API Key Input */}
          {showApiInput && (
            <div className="p-4 border-b">
              <div className="flex gap-2 mb-2">
                <input
                  type="password"
                  value={apiKey}
                  onChange={(e) => setApiKey(e.target.value)}
                  placeholder="Enter Anthropic API key"
                  className="flex-1 p-2 border rounded"
                />
                <button
                  onClick={() => {
                    if (apiKey.trim()) {
                      setShowApiInput(false);
                      setError('');
                      localStorage.setItem('claude-api-key', apiKey);
                    }
                  }}
                  className="bg-purple-600 text-white px-4 py-2 rounded"
                >
                  Save
                </button>
              </div>
              <button 
                onClick={() => setShowGuide(!showGuide)}
                className="text-sm text-purple-600 hover:underline"
              >
                {showGuide ? 'Hide' : 'Show'} API Key Guide
              </button>
              
              {showGuide && (
                <div className="api-key-guide">
                  <h3 className="font-bold mb-2">How to get your API key:</h3>
                  <ol className="list-decimal pl-5 space-y-1 text-sm">
                    <li>Go to <a href="https://console.anthropic.com/settings/keys" target="_blank" className="text-purple-600 hover:underline">Anthropic API Keys</a></li>
                    <li>Sign in or create an account</li>
                    <li>Click "Create Key"</li>
                    <li>Copy the key and paste it above</li>
                    <li>Note: Claude API has separate rate limits from ChatGPT</li>
                  </ol>
                </div>
              )}
            </div>
          )}

          {/* Messages */}
          <div className="messages">
            {error && (
              <div className="error-message">
                {error}
                {error.includes('Invalid API key') && (
                  <button 
                    onClick={() => setShowApiInput(true)}
                    className="text-purple-600 hover:underline ml-2"
                  >
                    Update Key
                  </button>
                )}
              </div>
            )}

            {messages.map(message => (
              <div
                key={message.id}
                className={message.sender === 'user' ? 'user-message' : 'ai-message'}
              >
                {formatMessage(message.text, message.isCode)}
              </div>
            ))}

            {isLoading && (
              <div className="ai-message">
                <div className="typing-indicator">
                  <div className="typing-dot"></div>
                  <div className="typing-dot"></div>
                  <div className="typing-dot"></div>
                </div>
              </div>
            )}
            <div ref={messagesEndRef} />
          </div>

          {/* Input Area */}
          <div className="input-area">
            <div className="flex gap-2">
              <input
                type="text"
                value={inputValue}
                onChange={(e) => setInputValue(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
                placeholder="Type your coding question..."
                className="flex-1 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                disabled={isLoading}
              />
              <button
                onClick={handleSendMessage}
                disabled={!inputValue.trim() || isLoading}
                className="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 disabled:opacity-50"
              >
                Send
              </button>
            </div>
          </div>

          {/* Confirmation Dialog */}
          {showConfirm && (
            <div className="confirmation-dialog">
              <div className="confirmation-box">
                <h3 className="font-bold text-lg mb-4">Clear Chat History</h3>
                <p className="mb-6">Are you sure you want to delete all chat history? This cannot be undone.</p>
                <div className="flex justify-end gap-3">
                  <button
                    onClick={() => setShowConfirm(false)}
                    className="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={clearHistory}
                    className="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"
                  >
                    Delete
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<ClaudeCodingAssistant />);
  </script>
</body>
</html>
