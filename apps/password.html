<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <title>Password Game</title>
  <style>
    :root {
      --bg-color: #1e1e1e;
      --text-color: #e0e0e0;
      --box-bg: #2b2b2b;
      --box-shadow: 0 0 15px rgba(0, 200, 255, 0.4);
      --btn-bg: #3399ff;
      --btn-hover: #007acc;
    }

    [data-theme="light"] {
      --bg-color: #f4f4f4;
      --text-color: #000;
      --box-bg: white;
      --box-shadow: 0 0 15px rgba(0, 153, 255, 0.4);
      --btn-bg: #007BFF;
      --btn-hover: #0056b3;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      padding: 20px;
      transition: background-color 0.3s, color 0.3s;
    }

    .container {
      background-color: var(--box-bg);
      max-width: 600px;
      margin: auto;
      padding: 20px;
      border-radius: 10px;
      box-shadow: var(--box-shadow);
      transition: background-color 0.3s, box-shadow 0.3s;
    }

    h2 {
      text-align: center;
    }

    label, input {
      display: block;
      width: 100%;
      margin-bottom: 10px;
    }

    input {
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    button {
      margin-top: 10px;
      padding: 10px;
      width: 100%;
      background: var(--btn-bg);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background: var(--btn-hover);
    }

    #message {
      color: red;
      text-align: center;
      margin-top: 10px;
    }

    #modeSwitcher {
      margin: 20px auto;
      display: block;
      background: #333;
      color: white;
      width: auto;
    }

    #strength {
      text-align: center;
      font-weight: bold;
    }
  </style>
</head>
<body>
<button id="modeSwitcher">Switch to Light Mode</button>
<div class="container">
  <h2 id="title">Create Your Password</h2>
  <div id="form"></div>
  <div id="strength"></div>
  <button id="submitBtn">Submit</button>
  <p id="message"></p>
  <button id="toggleMode">Switch to Login</button>
</div>

<script>
  const PROMPT_TIERS = {
    easy: ["What is your favorite color?", "What’s your favorite food?", "What city were you born in?", "Favorite hobby?", "Favorite day of the week?", "Favorite dessert?", "Favorite drink?", "Favorite number?", "Favorite fruit?", "Birth month?"],
    medium: ["What was your first car?", "What’s your best friend’s name?", "What was your childhood nickname?", "What is your dream job?", "Favorite teacher’s name?", "Where did you go on your first trip?", "What’s your favorite book?", "What is your mother’s maiden name?", "Where did you go to college?", "What’s the make of your first laptop?"],
    hard: ["What is your biggest fear?", "What’s a secret no one knows?", "Describe your first heartbreak.", "What’s a painful childhood memory?", "Who has influenced you the most?", "What do you regret not doing?", "What’s your biggest insecurity?", "What memory still haunts you?", "What’s something you never told anyone?", "What’s something you can’t forgive?"]
  };

  let level = 1;
  let mode = 'create';
  let selectedPrompts = [];
  let expectedAnswers = {};
  const formDiv = document.getElementById('form');
  const submitBtn = document.getElementById('submitBtn');
  const toggleBtn = document.getElementById('toggleMode');
  const title = document.getElementById('title');
  const message = document.getElementById('message');
  const modeSwitcher = document.getElementById('modeSwitcher');
  const strengthDiv = document.getElementById('strength');

  function getPrompts(level) {
    const result = [];
    if (level >= 1) result.push(random(PROMPT_TIERS.easy));
    if (level >= 2) result.push(random(PROMPT_TIERS.medium));
    if (level >= 3) result.push(random(PROMPT_TIERS.hard));
    return result;
  }

  function random(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  function renderForm(prompts) {
    formDiv.innerHTML = '';
    prompts.forEach((prompt, index) => {
      const label = document.createElement('label');
      label.textContent = `[${["Easy", "Medium", "Hard"][index] || "Extra"}] ${prompt}`;
      const input = document.createElement('input');
      input.type = 'text';
      input.dataset.prompt = prompt;
      input.addEventListener('input', updateStrength);
      formDiv.appendChild(label);
      formDiv.appendChild(input);
    });
    updateStrength();
  }

  function updateStrength() {
    const inputs = formDiv.querySelectorAll('input');
    let score = 0;
    inputs.forEach(input => {
      if (input.value.length > 4) score += 1;
      if (new Set(input.value).size > 4) score += 1;
    });
    const rating = ["Very Weak", "Weak", "Moderate", "Strong", "Very Strong"];
    const index = Math.min(Math.floor(score / 2), rating.length - 1);
    strengthDiv.textContent = `Password Strength: ${rating[index]}`;
  }

  async function hash(text) {
    const data = new TextEncoder().encode(text);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
  }

  function saveHashedAnswers(prompts, hashes) {
    localStorage.setItem('passwordPrompts', JSON.stringify({ prompts, hashes }));
  }

  function loadSaved() {
    return JSON.parse(localStorage.getItem('passwordPrompts') || '{}');
  }

  function initCreateMode() {
    mode = 'create';
    title.textContent = "Create Your Password";
    toggleBtn.textContent = "Switch to Login";
    selectedPrompts = getPrompts(level);
    renderForm(selectedPrompts);
    message.textContent = '';
  }

  function initLoginMode() {
    const saved = loadSaved();
    if (!saved.prompts) {
      message.style.color = 'red';
      message.textContent = "No password stored. Please create one.";
      return;
    }
    mode = 'login';
    title.textContent = "Login With Your Password";
    toggleBtn.textContent = "Switch to Create";
    selectedPrompts = saved.prompts;
    expectedAnswers = saved.hashes;
    renderForm(selectedPrompts);
    message.textContent = '';
  }

  async function handleSubmit() {
    const inputs = formDiv.querySelectorAll('input');
    let allCorrect = true;
    const hashMap = {};

    for (const input of inputs) {
      const prompt = input.dataset.prompt;
      const value = input.value.trim();
      const hashed = await hash(value);

      if (mode === 'create') {
        hashMap[prompt] = hashed;
      } else {
        if (hashed !== expectedAnswers[prompt]) {
          allCorrect = false;
        }
      }
    }

    if (mode === 'create') {
      saveHashedAnswers(selectedPrompts, hashMap);
      level++;
      message.style.color = 'green';
      message.textContent = "Password created. Level up!";
      setTimeout(() => initCreateMode(), 1000);
    } else {
      if (allCorrect) {
        message.style.color = 'green';
        message.textContent = "Login successful!";
      } else {
        message.style.color = 'red';
        message.textContent = "Incorrect answers. Try again.";
        renderForm(selectedPrompts);
      }
    }
  }

  submitBtn.addEventListener('click', handleSubmit);
  toggleBtn.addEventListener('click', () => mode === 'create' ? initLoginMode() : initCreateMode());
  modeSwitcher.addEventListener('click', () => {
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
    modeSwitcher.textContent = isDark ? 'Switch to Dark Mode' : 'Switch to Light Mode';
  });

  initCreateMode();
</script>
</body>
</html>
